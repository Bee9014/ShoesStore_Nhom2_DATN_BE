<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
          "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

     <mapper namespace="com.fpl.edu.shoeStore.product.mapper.ProductVariantMapper">

         <!-- Result Map -->
         <resultMap id="ProductVariantResultMap"
     type="com.fpl.edu.shoeStore.product.entity.ProductVariant">
             <id property="variantId" column="variant_id"/>
             <result property="productId" column="product_id"/>
             <result property="productVariantCode" column="product_variant_code"/>
             <result property="price" column="price"/>
             <result property="stockQty" column="stock_qty"/>
             <result property="weightGrams" column="weight_grams"/>
             <result property="attribute" column="attribute"/>
             <result property="image" column="image"/>
             <result property="createAt" column="create_at"/>
             <result property="updateAt" column="update_at"/>
             <result property="createBy" column="create_by"/>
             <result property="updateBy" column="update_by"/>
         </resultMap>

         <!-- Find by Product ID -->
         <select id="findByProductId" parameterType="int"
     resultMap="ProductVariantResultMap">
             SELECT variant_id,
                    product_id,
                    product_variant_code,
                    price,
                    stock_qty,
                    weight_grams,
                    attribute,
                    image,
                    create_at,
                    update_at,
                    create_by,
                    update_by
             FROM product_variant
             WHERE product_id = #{productId}
             ORDER BY variant_id ASC
         </select>

         <!-- Find by Variant ID -->
         <select id="findById" parameterType="int" resultMap="ProductVariantResultMap">
             SELECT variant_id,
                    product_id,
                    product_variant_code,
                    price,
                    stock_qty,
                    weight_grams,
                    attribute,
                    image,
                    create_at,
                    update_at,
                    create_by,
                    update_by
             FROM product_variant
             WHERE variant_id = #{variantId}
         </select>

         <!-- Insert -->
         <insert id="insert"
     parameterType="com.fpl.edu.shoeStore.product.entity.ProductVariant"
                 useGeneratedKeys="true"
                 keyProperty="variantId">
             INSERT INTO product_variant (
                 product_id,
                 product_variant_code,
                 price,
                 stock_qty,
                 weight_grams,
                 attribute,
                 image,
                 create_at,
                 update_at,
                 create_by,
                 update_by
             )
             VALUES (
                 #{productId},
                 #{productVariantCode},
                 #{price},
                 #{stockQty},
                 #{weightGrams},
                 #{attribute},
                 #{image},
                 GETDATE(),
                 GETDATE(),
                 #{createBy},
                 #{updateBy}
             )
         </insert>

         <!-- Update -->
         <update id="update"
     parameterType="com.fpl.edu.shoeStore.product.entity.ProductVariant">
             UPDATE product_variant
             SET product_id = #{productId},
                 product_variant_code = #{productVariantCode},
                 price = #{price},
                 stock_qty = #{stockQty},
                 weight_grams = #{weightGrams},
                 attribute = #{attribute},
                 image = #{image},
                 update_at = GETDATE(),
                 update_by = #{updateBy}
             WHERE variant_id = #{variantId}
         </update>

         <!-- Delete by ID -->
         <delete id="deleteById" parameterType="int">
             DELETE FROM product_variant
             WHERE variant_id = #{variantId}
         </delete>

         <!-- Find All Variants -->
         <select id="findAll" resultMap="ProductVariantResultMap">
             SELECT variant_id,
                    product_id,
                    product_variant_code,
                    price,
                    stock_qty,
                    weight_grams,
                    attribute,
                    image,
                    create_at,
                    update_at,
                    create_by,
                    update_by
             FROM product_variant
             ORDER BY variant_id DESC
         </select>

         <!-- Update Stock Quantity -->
         <update id="updateStock" parameterType="map">
             UPDATE product_variant
             SET stock_qty = stock_qty + #{quantity},
                 update_at = GETDATE()
             WHERE variant_id = #{variantId}
         </update>

         <!-- Find by Product Variant Code -->
         <select id="findByCode" parameterType="string" resultMap="ProductVariantResultMap">
             SELECT variant_id,
                    product_id,
                    product_variant_code,
                    price,
                    stock_qty,
                    weight_grams,
                    attribute,
                    image,
                    create_at,
                    update_at,
                    create_by,
                    update_by
             FROM product_variant
             WHERE product_variant_code = #{productVariantCode}
         </select>

     </mapper>